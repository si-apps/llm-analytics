<html lang="en">
    <head>
        <title>LLM Analytics</title>
        <link href="https://unpkg.com/tabulator-tables@6.2.5/dist/css/tabulator.min.css" rel="stylesheet">
        <script src="static/llm_analytics.js"></script>
        <link href="static/style.css" rel="stylesheet">
        <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.2.5/dist/js/tabulator.min.js"></script>
{% if recaptcha_key != "" %}
    {% block captcha_content %}
<script src="https://www.google.com/recaptcha/api.js?render={{recaptcha_key}}"></script>
<script>
    async function get_captcha_token()
    {
        var recaptcha_token = '';
        grecaptcha.ready(() => {
            grecaptcha.execute('{{recaptcha_key}}', {action: 'submit'}).then((token) => {
                recaptcha_token = token;
            });
        });
        while(recaptcha_token === ''){
            await new Promise(r => setTimeout(r, 100));
        }
        return recaptcha_token;
    }
</script>
    {% endblock captcha_content %}
{% else %}
    {% block no_captcha_content %}
<script>
    async function get_captcha_token()
    {
        return "";
    }
</script>
    {% endblock no_captcha_content %}
{% endif %}
{% if gtag != "" %}
    {% block analytics_content %}
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id={{gtag}}"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '{{gtag}}');
        </script>
    {% endblock analytics_content %}
{% endif %}
<script type="module">
    import * as duckdb from "https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm/+esm";

    async function instantiate(duckdb) {
  const CDN_BUNDLES = duckdb.getJsDelivrBundles(),
  bundle = await duckdb.selectBundle(CDN_BUNDLES),
  worker_url = URL.createObjectURL(
    new Blob([ `importScripts("${bundle.mainWorker}");` ], {
      type: "text/javascript"
    })
  );
  const worker = new Worker(worker_url),
  logger = new duckdb.ConsoleLogger("DEBUG"),
  db = new duckdb.AsyncDuckDB(logger, worker);

  await db.instantiate(bundle.mainModule, bundle.pthreadWorker);
  URL.revokeObjectURL(worker_url);
  return db;
}
window.duck_db = await instantiate(duckdb);
        </script>
    </head>
<body>

    <input onchange="file_change()" type="file" id="file" name="file" /><label id="record_count"></label>

    <br/><br/>
    <textarea class="search-box" id="question_input-0" rows="3" onkeydown="handleKeyDown(event)"></textarea>
    <br/>

    <span style="display:{% if advanced %}block{% else %}none{% endif %};">
        <br/>
        <label>Samples:<input style="width: 30px" type="number" id="num_samples" value="5"/></label>
        <label>Model:<select style="width: 120px" id="model_id">
            <option value="anthropic.claude-instant-v1" selected="selected">Claude Instant</option>
            <option value="ai21.jamba-instruct-v1:0">Jamba Instruct</option>
        </select></label>
        <label>Hint:<input style="width: 30%" type="text" id="hint" value=""/></label>
        <label>version: {{version}}</label>
    </span>
    <div class="status-bar">
        <span id="status-0" class="status-text"></span>
    </div>
    <div class="results" id="results-table-0"></div>
    <br/>
    <table class="sub-results">
        <tr>
            <td class="sub-results-drill-down-button">
                <button id="drill_down_button-0" class="plus-button" style="display: none" onclick="document.getElementById('drill_down-0').style.display = 'block'">+</button>
            </td>
            <td class="sub-results-results">
    <div id="drill_down-0" style="display: none;">
        <textarea class="search-box" id="question_input-1" rows="3" onkeydown="handleKeyDown(event)"></textarea>
        <div class="status-bar">
            <span id="status-1" class="status-text"></span>
        </div>
        <div class="results" id="results-table-1"></div>
        <br/>
        <table class="sub-results">
            <tr>
                <td class="sub-results-drill-down-button">
                    <button id="drill_down_button-1" class="plus-button" style="display: none" onclick="document.getElementById('drill_down-1').style.display = 'block'">+</button>
                </td>
                <td class="sub-results-results">
<div id="drill_down-1" style="display: none;">
        <textarea class="search-box" id="question_input-2" rows="3" onkeydown="handleKeyDown(event)"></textarea>
        <div class="status-bar">
            <span id="status-2" class="status-text"></span>
        </div>
        <div class="results" id="results-table-2"></div>
</div>
                </td>
            </tr>
        </table>
    </div>
            </td>
        </tr>
    </table>
</body>
</html>